(this["webpackJsonp@xenpaper/xenpaper-app"]=this["webpackJsonp@xenpaper/xenpaper-app"]||[]).push([[0],{73:function(e,t,n){"use strict";n.r(t);var r,o,c,i,a,s,l,u=n(10),d=n.n(u),h=n(41),b=n.n(h),j=n(25),f=n(16),p=n(9),m=n(8),v=n.n(m),O=n(13),g=n(12),x=n(15),y=n(4),w=Object(x.b)(r||(r=Object(f.a)(["\n    html, body, div, span, applet, object, iframe,\n    h1, h2, h3, h4, h5, h6, p, blockquote, pre,\n    a, abbr, acronym, address, big, cite, code,\n    del, dfn, em, img, ins, kbd, q, s, samp,\n    small, strike, strong, sub, sup, tt, var,\n    b, u, i, center,\n    dl, dt, dd, ol, ul, li,\n    fieldset, form, label, legend,\n    table, caption, tbody, tfoot, thead, tr, th, td,\n    article, aside, canvas, details, embed,\n    figure, figcaption, footer, header, hgroup,\n    menu, nav, output, ruby, section, summary,\n    time, mark, audio, video {\n        margin: 0;\n        padding: 0;\n        border: 0;\n        font-size: 100%;\n        font: inherit;\n        vertical-align: baseline;\n    }\n    article, aside, details, figcaption, figure,\n    footer, header, hgroup, menu, nav, section {\n        display: block;\n    }\n    body {\n        line-height: 1;\n    }\n    ol, ul {\n        list-style: none;\n    }\n    blockquote, q {\n        quotes: none;\n    }\n    blockquote:before, blockquote:after,\n    q:before, q:after {\n        content: '';\n        content: none;\n    }\n    table {\n        border-collapse: collapse;\n        border-spacing: 0;\n    }\n    * {\n        box-sizing: border-box;\n    }\n\n    html {\n        font-family: 'DM Mono', sans-serif;\n        height: 100%;\n        line-height: 1.5em;\n        position: relative;\n        -webkit-font-smoothing: antialiased;\n        -moz-osx-font-smoothing: grayscale;\n        background-color: #0e151b;\n        color: #ffffff;\n        font-size: 16px;\n    }\n\n    body {\n        font-weight: 400;\n        height: 100%;\n        line-height: 1.5em;\n        overflow-x: hidden;\n        text-rendering: optimizelegibility;\n\n        &[aria-hidden='true'] {\n            overflow: hidden;\n        }\n    }\n\n    #root {\n        height: 100%;\n    }\n"]))),k={colors:{background:{normal:"#0e151b",light:"#18232d"},text:{placeholder:"#198c8c"},focus:"#115d5d",highlights:{delimiter:"#198c8c",pitch:"#22cece",chord:"#22cece",setterGroup:"#821361",setter:"#d61ba4",scaleGroup:"#94472f",scale:"#ff541e",comment:"#ffffff",commentStart:"#198c8c",unknown:"#a490b3",error:"#cc0000",errorMessage:"#cc0000"}},fonts:{mono:"'DM Mono', sans-serif",copy:"'Nunito', sans-serif"},widths:{sm:"640px"}};function S(e){var t=e.children;return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("link",{rel:"preconnect",href:"https://fonts.gstatic.com"}),Object(y.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,400;0,500;1,400&display=swap",rel:"stylesheet"}),Object(y.jsx)("link",{href:"https://fonts.googleapis.com/css2?family=Nunito:wght@300;400&display=swap",rel:"stylesheet"}),Object(y.jsxs)(x.a,{theme:k,children:[Object(y.jsx)(w,{}),t]})]})}var E,z,T,M,C,R,N,P,_,A,L,D,H,G,F,q,I,B,V,U,W,Y,X,Z,K,J,Q,$,ee,te,ne=Object(x.e)(o||(o=Object(f.a)(["\n  0% {\n    clip-path: polygon(0% 0%, 0% 0%, 100% 100%, 100% 100%, 100% 100%, 0% 0%);\n  }\n\n  20% {\n    clip-path: polygon(0% 0%, 0% 0%, 100% 100%, 100% 100%, 100% 100%, 0% 0%);\n  }\n\n  100% {\n    clip-path: polygon(0% 0%, 100% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 100%);\n  }\n"]))),re=Object(x.e)(c||(c=Object(f.a)(["\n  0% {\n    clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, 100% 100%, 100% 100%, 100% 100%, 0% 0%);\n  }\n\n  100% {\n    clip-path: polygon(100% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 100%, 0% 100%, 100% 100%, 100% 0%, 100% 0%);\n  }\n"]))),oe=Object(x.e)(i||(i=Object(f.a)(["\n  0% {\n    fill: #115d5d;\n  }\n\n  20% {\n    fill: #115d5d;\n  }\n\n  100% {\n    fill: #fff;\n  }\n"]))),ce=Object(x.e)(a||(a=Object(f.a)(["\n  0% {\n    fill: #fff;\n  }\n\n  100% {\n    fill: #115d5d;\n  }\n"]))),ie=x.d.button(s||(s=Object(f.a)(["\n    border: none;\n    display: block;\n    height: 3rem;\n    width: 3rem;\n    padding: 1rem .5rem;\n    cursor: pointer;\n    background-color: rgba(0,0,0,0);\n    position: relative;\n    outline: none;\n\n    transition: border-color .2s ease-out;\n    border-left: 3px solid transparent;\n\n    &:focus, &:active {\n        border-left: 3px solid ",";\n    }\n\n    ","\n\n    ","\n"])),(function(e){return e.theme.colors.focus}),(function(e){return e.hoverBackground?"&:hover {\n        background-color: ".concat(e.theme.colors.background.light,";\n    }"):""}),(function(e){return e.large&&"@media all and (min-width: ".concat(e.theme.widths.sm,") {\n        height: 4rem;\n        width: 5rem;\n        padding: 1rem;\n    }")})),ae=x.d.div(l||(l=Object(f.a)(["\n    position: absolute;\n    top: 0;\n    left: 0;\n    height: 3rem;\n    width: 2rem;\n    padding: 1rem .5rem;\n    animation: "," .3s ease-out forwards;\n    margin-left: .5rem;\n\n    path {\n        fill: #fff;\n        animation: "," .3s ease-out forwards;\n    }\n\n    opacity: .9;\n    &:hover {\n        opacity: 1;\n    }\n\n    ","\n"])),(function(e){return e.show?ne:re}),(function(e){return e.show?oe:ce}),(function(e){return e.large&&"@media all and (min-width: ".concat(e.theme.widths.sm,") {\n        height: 4rem;\n        width: 4rem;\n        padding: 1rem;\n    }")})),se=d.a.memo((function(e){var t=e.state,n=e.paths,r=e.onClick,o=e.loaded,c=void 0===o||o,i=e.hoverBackground,a=void 0!==i&&i,s=e.large,l=void 0!==s&&s;return Object(y.jsx)(ie,{onClick:function(){return r&&r(t)},hoverBackground:a,large:l,children:Object.keys(n).map((function(e){return Object(y.jsx)(ae,{show:c&&t===e,large:l,children:Object(y.jsx)("svg",{viewBox:"0 0 12 12",children:n[e].map((function(e,t){return Object(y.jsx)("path",{d:e},t)}))})},e)}))})})),le=n(22),ue=x.d.span(E||(E=Object(f.a)(["\n    ","\n    ","\n    ","\n    ","\n"])),le.j,le.k,le.i,le.c),de=function(e){var t=e.value,n=e.onChange,r=e.charElements,o=e.freeze,c=""===t?Object(y.jsxs)(ue,{color:"text.placeholder",style:{fontStyle:"italic"},children:["Type your tune here",Object(y.jsx)("br",{}),Object(y.jsx)("br",{})]}):Object(y.jsxs)(y.Fragment,{children:[r,Object(y.jsx)("br",{}),Object(y.jsx)("br",{})]});return Object(y.jsx)(he,{fontSize:["1.1rem","1.4rem"],disabled:o,children:Object(y.jsxs)(be,{children:[Object(y.jsx)(je,{value:t,onChange:n,autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",spellCheck:"false",disabled:o}),Object(y.jsx)(fe,{"aria-hidden":"true",freeze:o,children:c})]})})},he=x.d.div(z||(z=Object(f.a)(["\n    height: 100%;\n    overflow: auto;\n    ","\n    ",'\n    line-height: 1.4em;\n    position: relative;\n\n    &:before {\n        content: "";\n        display: block;\n        width: 3px;\n        height: 4rem;\n        background-color: transparent;\n        transition: background-color .2s ease-out;\n        position: absolute;\n        top: 12px;\n    }\n\n    &:focus-within {\n        &:before {\n            background-color: ',";\n        }\n    }\n\n    ","\n"])),le.j,le.k,(function(e){return e.theme.colors.focus}),(function(e){return e.disabled?"\n        cursor: default;\n        user-select: none;\n        pointer-events: none;\n    ":""})),be=x.d.div(T||(T=Object(f.a)(["\n    position: relative;\n    text-align: left;\n    box-sizing: border-box;\n    padding: 0px;\n    overflow: hidden;\n    font-variant-ligatures: common-ligatures;\n    min-height: 100%;\n"]))),je=x.d.textarea(M||(M=Object(f.a)(["\n    margin: 0;\n    border: 0;\n    background: none;\n    box-sizing: inherit;\n    display: inherit;\n    font-family: inherit;\n    font-size: inherit;\n    font-style: inherit;\n    font-variant-ligatures: inherit;\n    font-weight: inherit;\n    letter-spacing: inherit;\n    line-height: inherit;\n    tab-size: inherit;\n    text-indent: inherit;\n    text-rendering: inherit;\n    text-transform: inherit;\n    white-space: pre-wrap;\n    word-break: keep-all;\n    overflow-wrap: break-word;\n    position: absolute;\n    top: 0;\n    left: 0;\n    height: 100%;\n    width: 100%;\n    resize: none;\n    color: inherit;\n    overflow: hidden;\n    -webkit-text-fill-color: transparent;\n    -webkit-font-smoothing: antialiased;\n    padding: 1rem 1rem 1rem 2rem;\n    outline: 0;\n\n    &::selection {\n        background: #22cece;\n    }\n\n    &:disabled {\n        user-select: none;\n        opacity: 0;\n    }\n"]))),fe=x.d.pre(C||(C=Object(f.a)(["\n    margin: 0px;\n    border: 0px;\n    background: none;\n    box-sizing: inherit;\n    display: inherit;\n    font-family: inherit;\n    font-size: inherit;\n    font-style: inherit;\n    font-variant-ligatures: inherit;\n    font-weight: inherit;\n    letter-spacing: inherit;\n    line-height: inherit;\n    tab-size: inherit;\n    text-indent: inherit;\n    text-rendering: inherit;\n    text-transform: inherit;\n    white-space: pre-wrap;\n    word-break: keep-all;\n    overflow-wrap: break-word;\n    position: relative;\n    pointer-events: ",";\n    padding: 1rem 1rem 1rem 2rem;\n    user-select: none;\n"])),(function(e){return e.freeze?"auto":"none"})),pe=Object(x.e)(R||(R=Object(f.a)(["\n  0% {\n    opacity: 0;\n    top: 1rem;\n  }\n\n  85% {\n    opacity: 0;\n    top: 1rem;\n  }\n\n  100% {\n    opacity: 1;\n    top: 0rem;\n  }\n"]))),me=x.d.div(N||(N=Object(f.a)(["\n    position: relative;\n    top: 0;\n    padding-left: 1rem;\n    animation: "," .7s ease-out forwards;\n"])),pe),ve=Object(x.e)(P||(P=Object(f.a)(["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n"]))),Oe=x.d.div(_||(_=Object(f.a)(["\n    height: ",";\n    opacity: 0;\n    ","\n"])),(function(e){return e.height}),(function(e){return e.loaded?Object(x.c)(A||(A=Object(f.a)(["animation: "," .1s ease-out forwards;"])),ve):""})),ge=d.a.memo((function(e){var t=e.ch,n=e.charData,r=e.soundEngine,o=Object(u.useState)(!1),c=Object(g.a)(o,2),i=c[0],a=c[1];return function(e,t){var n=Object(u.useRef)(0),r=Object(u.useRef)(performance.now()),o=Object(u.useRef)(performance.now()),c=function t(){var c=performance.now(),i=(c-o.current)/1e3,a=(c-r.current)/1e3;e(i,a),r.current=c,n.current=requestAnimationFrame(t)};Object(u.useEffect)((function(){return n.current=requestAnimationFrame(c),function(){return cancelAnimationFrame(n.current)}}),t)}((function(){var e,t=r.playing()?r.position():-1,o=null!==(e=null===n||void 0===n?void 0:n.playTime)&&void 0!==e?e:[],c=Object(g.a)(o,2),i=c[0],s=c[1];a(-1!==t&&void 0!==i&&void 0!==s&&i<=t&&s>t)}),[t,n]),Object(y.jsx)(xe,{className:i?"active":"",color:null===n||void 0===n?void 0:n.color,children:t})})),xe=x.d.span(L||(L=Object(f.a)(["\n    color: ",";\n    transition: color 0.2s "," ease-out;\n\n    &.active {\n        transition: color 0s 0s linear;\n        color: #fff;\n    }\n"])),(function(e){return e.theme.colors.highlights[e.color||"unknown"]}),(function(e){return"error"===e.color?"0.5s":"0s"})),ye=Object(le.d)(le.i,le.c,le.g,le.e,le.f,le.a,le.b,le.h),we=x.d.div(D||(D=Object(f.a)(["\n    ","\n"])),ye),ke=x.d.div(H||(H=Object(f.a)(["\n    display: flex;\n    ","\n"])),ye),Se=n.p+"static/media/xenpaper-logo-512x512.19f23cff.png",Ee=n(38),ze=x.d.a(G||(G=Object(f.a)(["\n    color: ",";\n    text-decoration: none;\n    font-style: normal;\n\n    &:hover, &:focus {\n        color: #fff;\n        text-decoration: underline;\n    }\n\n    &:active {\n        color: #fff;\n    }\n"])),(function(e){return e.theme.colors.highlights.unknown})),Te=Object(x.d)((function(e){return Object(y.jsx)(we,Object(p.a)(Object(p.a)({px:3,py:2},e),{},{children:Object(y.jsxs)(ue,{as:"div",color:"text.placeholder",children:[Object(y.jsx)(ze,{href:"#",children:"Xenpaper"})," ",Object(y.jsx)(ze,{target:"_blank",href:"https://github.com/dxinteractive/xenpaper/releases",children:"(v1.7.0)"})," is made by ",Object(y.jsx)(ze,{target:"_blank",href:"https://damienclarke.me",children:"Damien Clarke"})," using ",Object(y.jsx)(ze,{target:"_blank",href:"https://www.typescriptlang.org/",children:"typescript"}),", ",Object(y.jsx)(ze,{target:"_blank",href:"https://reactjs.org/",children:"react"}),", ",Object(y.jsx)(ze,{target:"_blank",href:"https://tonejs.github.io/",children:"tonejs"}),", ",Object(y.jsx)(ze,{target:"_blank",href:"https://github.com/dmaevsky/rd-parse",children:"rd-parse"}),", ",Object(y.jsx)(ze,{target:"_blank",href:"https://styled-components.com/",children:"styled-components"})," and ",Object(y.jsx)(ze,{target:"_blank",href:"https://dendriform.xyz",children:"dendriform"}),"."]})}))}))(F||(F=Object(f.a)(["\n    font-size: .9rem;\n    font-family: ",";\n"])),(function(e){return e.theme.fonts.copy})),Me=function(e){var t=e.onSetTune,n=e.setSidebar;return Object(y.jsxs)(Pe,{setSidebar:n,pad:!0,children:[Object(y.jsx)(He,{children:"How it works"}),Object(y.jsxs)(De,{children:["Create tunes by typing in the text area. Press play to hear what you","'","ve written."]}),Object(y.jsx)(we,{pt:4,children:Object(y.jsx)(He,{children:"Notes"})}),Object(y.jsxs)(De,{children:["Typing a number will create a note. Notes can be separated by spaces or commas.",Object(y.jsx)(qe,{tune:"0 4 7 12",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Notes can be held for longer with hyphens ",Object(y.jsx)(Fe,{children:"---"}),", and rests can be added with dots ",Object(y.jsx)(Fe,{children:"..."}),".",Object(y.jsx)(qe,{tune:"0.2.3...3-2-0--.",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Spaces, new lines and bars ",Object(y.jsx)(Fe,{children:"|"})," can be placed anywhere between notes. Bars can also be placed during a note.",Object(y.jsx)(qe,{tune:"0 8 7-|0 8 7-|-5 4--",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Notes can be written in many ways.",Object(y.jsx)("br",{}),"- as scale degrees starting from zero ",Object(y.jsx)(Fe,{children:"0,2,4"}),",",Object(y.jsx)("br",{}),"- as ratios ",Object(y.jsx)(Fe,{children:"3/2,5/4,1/1"}),",",Object(y.jsx)("br",{}),"- as cents ",Object(y.jsx)(Fe,{children:"702c"}),",",Object(y.jsx)("br",{}),"- as divisions of an octave ",Object(y.jsxs)(Fe,{children:["11","\\","19"]}),",",Object(y.jsx)("br",{}),"- as divisions of an octave with a specific size (e.g. 3) ",Object(y.jsxs)(Fe,{children:["5","\\","13o3"]}),Object(y.jsx)("br",{}),"- as cycles per second ",Object(y.jsx)(Fe,{children:"432Hz"}),Object(y.jsx)(qe,{tune:"0 7 1/1 3/2 0c 702c\n0\\19 11\\19 220Hz 330Hz",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Notes can be shifted up or down octaves. ",Object(y.jsx)(Fe,{children:"'"})," shifts the following note up 1 octave, ",Object(y.jsx)(Fe,{children:'"'})," shifts the following note up 2 octaves, and ",Object(y.jsx)(Fe,{children:"`"})," shifts the following note down an octave.",Object(y.jsx)(qe,{tune:"0-3-'0-'3-\"0-'\"0-`0-``0-",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Chords can be played by using ",Object(y.jsx)(Fe,{children:"["})," and ",Object(y.jsx)(Fe,{children:"]"})," around a comma-separated pitches.",Object(y.jsx)(qe,{tune:"[3,7]-[5,8]-[0,3,7]--.[1/1,6/5,3/2]--.",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Chords can also be played using colon-notated ratios ",Object(y.jsx)(Fe,{children:"4:5:6"}),Object(y.jsx)(qe,{tune:"10:12:15---",color:"pitch",onSetTune:t})]}),Object(y.jsx)(we,{pt:4,children:Object(y.jsx)(He,{children:"Comments"})}),Object(y.jsxs)(De,{children:["Comments can be added using ",Object(y.jsx)(Fe,{children:"#"})," at the start of a line",Object(y.jsx)(qe,{tune:"# a 7th chord\n[0,4,7,10]--..\n\n# a harmonic 7th chord\n4:5:6:7--..",color:"pitch",onSetTune:t})]}),Object(y.jsx)(we,{pt:4,children:Object(y.jsx)(He,{children:"Scales"})}),Object(y.jsxs)(De,{children:["The scale can be changed at any time. A scale is denoted by ",Object(y.jsx)(Fe,{children:"{"})," and ",Object(y.jsx)(Fe,{children:"}"}),". These dictate what pitches any subsequent scale degrees correspond to. The default is 12 equal divisons of the octave ",Object(y.jsx)(Fe,{children:"12edo"}),".",Object(y.jsx)(qe,{tune:"[0,4,7]--- {31edo}[0,10,18]---",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Equal division octave size can be changed by replacing the ",'"o"'," with a number or fraction ",Object(y.jsx)(Fe,{children:"13ed3"}),".",Object(y.jsx)(qe,{tune:"{13ed3}0 1 2 3 4",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Scales can be comprised of individual pitches.",Object(y.jsx)(qe,{tune:"{1/1 9/8 5/4 4/3 3/2 5/3 15/8}\n0 1 2 3 4 5 6 7-",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Scales comprised of individual pitches can also set their octave size using ",Object(y.jsx)(Fe,{children:"'"})," after the last pitch. Defaults to ",Object(y.jsx)(Fe,{children:"2/1"}),Object(y.jsx)(qe,{tune:"{1/1 5/4 4/3 3/2'}\n0 1 2 3 4 5 6 7 8-",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Scales can use colon-notated ratios",Object(y.jsx)(qe,{tune:"{12:14:16:18:21}\n0 1 2 3 4 5 6 7-",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Scales can also reference the scale degrees at the moment they are encountered. This can be useful for creating a subset of a scale.",Object(y.jsx)(qe,{tune:"{19edo}{0 3 6 8 11 14 17}\n0 1 2 3 4 5 6 7-",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Modes can be set using ",Object(y.jsx)(Fe,{children:"{m"})," and ",Object(y.jsx)(Fe,{children:"}"}),".",Object(y.jsx)(qe,{tune:"{12edo}{m2 1 2 2 1 2 2}\n0 1 2 3 4 5 6 7-",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["All pitch values other than cycles-per-second are relative to a root note. This can be changed with ",Object(y.jsx)(Fe,{children:"{r...}"}),". It can be given any pitch value to use as the new root. It defaults to ",Object(y.jsx)(Fe,{children:"{r440Hz}"}),Object(y.jsx)(qe,{tune:"0 2 4-{r432Hz}0 2 4-",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["As each change to the root pitch is relative to the current root, multiple roots can be chained after each other",Object(y.jsx)(qe,{tune:"4 0-{r2}4 0-{r2}4 0-",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["This can also be used to switch octaves for a time.",Object(y.jsx)(qe,{tune:"4 0-{r'0}4 0-{r`0}4 0-",color:"pitch",onSetTune:t})]}),Object(y.jsx)(we,{pt:4,children:Object(y.jsx)(He,{children:"Setters"})}),Object(y.jsxs)(De,{children:["Setters are a type of statement that are used to set various parameters as a tune progresses, such as ",Object(y.jsx)(Fe,{children:"(bpm:100)"})," or ",Object(y.jsx)(Fe,{children:"(osc:sine)"}),". A setter is denoted by ",Object(y.jsx)(Fe,{children:"("})," and ",Object(y.jsx)(Fe,{children:")"}),", and can be placed anywhere between notes or on new lines. Multiple setters can be combined into a single statement using a semicolon ",Object(y.jsx)(Fe,{children:"(bpm:100; osc:sine)"})]}),Object(y.jsx)(we,{pt:4,children:Object(y.jsx)(He,{children:"Timing"})}),Object(y.jsxs)(De,{children:["Tempo can be changed using the tempo setter ",Object(y.jsx)(Fe,{children:"(bpm:...)"}),". Defaults to ",Object(y.jsx)(Fe,{children:"(bpm:120)"}),Object(y.jsx)(qe,{tune:"(bpm:200)7 5 4 2 0...",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Tempo can also be set using milliseconds per beat ",Object(y.jsx)(Fe,{children:"(bms:...)"}),".",Object(y.jsx)(qe,{tune:"(bms:1000)3 2 0",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Divisions of the beat can be set using the division setter ",Object(y.jsx)(Fe,{children:"(div:...)"}),". These can also be shortened to ",Object(y.jsx)(Fe,{children:"(...)"}),", like ",Object(y.jsx)(Fe,{children:"(4)"})," or ",Object(y.jsx)(Fe,{children:"(1/4)"}),". Defaults to 2 divisions per beat (eighth notes) ",Object(y.jsx)(Fe,{children:"(div:2)"}),Object(y.jsx)(qe,{tune:"0 2 3 7(3)0 2 3 7(4)0 2 3 7(1/2)0 2 3 7",color:"pitch",onSetTune:t})]}),Object(y.jsx)(we,{pt:4,children:Object(y.jsx)(He,{children:"Sound"})}),Object(y.jsxs)(De,{children:["The oscillator can be changed using the oscillator setter ",Object(y.jsx)(Fe,{children:"(osc:...)"}),". Defaults to ",Object(y.jsx)(Fe,{children:"(osc:triangle)"}),Object(y.jsx)(qe,{tune:"(osc:sine)0 4 7.\n(osc:sawtooth)0 4 7.\n(osc:square)0 4 7.",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["Valid values are ",Object(y.jsx)(Fe,{children:"sine"}),", ",Object(y.jsx)(Fe,{children:"sawtooth"}),", ",Object(y.jsx)(Fe,{children:"square"})," and ",Object(y.jsx)(Fe,{children:"triangle"}),". Any of these can be optionally prefixed with ",Object(y.jsx)(Fe,{children:"fm"}),", ",Object(y.jsx)(Fe,{children:"am"}),"or ",Object(y.jsx)(Fe,{children:"fat"}),". Any of these can be suffixed with an integer from ",Object(y.jsx)(Fe,{children:"1"})," to ",Object(y.jsx)(Fe,{children:"32"})," to indicate the number of partials to use.",Object(y.jsx)(qe,{tune:"(osc:fmsine)0 4 7.\n(osc:fatsquare)0 4 7.\n(osc:sawtooth5)0 4 7.",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["The envelope can be changed using the envelope setter ",Object(y.jsx)(Fe,{children:"(env:...)"}),". This accepts 4 digits corresponding to attack, decay, sustain and release, where ",Object(y.jsx)(Fe,{children:"0"})," is fast / small, and ",Object(y.jsx)(Fe,{children:"9"})," is slow / big. Defaults to ",Object(y.jsx)(Fe,{children:"(env:2856)"}),Object(y.jsx)(qe,{tune:"(env:0158)0-.....\n(env:6860)0---...",color:"pitch",onSetTune:t})]}),Object(y.jsxs)(De,{children:["All oscillator and envelope options are made possible by ",Object(y.jsx)(ze,{target:"_blank",href:"https://tonejs.github.io/",children:"tonejs"}),"."]}),Object(y.jsx)(we,{pt:4,children:Object(y.jsx)(He,{children:"Ruler"})}),Object(y.jsx)(De,{children:"The Ruler button displays a pitch ruler. Played notes will appear on it. Click and drag to pan, use the mouse wheel to zoom. Touch devices are not yet supported."}),Object(y.jsxs)(De,{children:["The current scale can be plotted by calling ",Object(y.jsx)(Fe,{children:"(plot)"}),". Calling it multiple times will render multiple scales. To see this demo, you must click Ruler after you click Demo.",Object(y.jsx)(qe,{tune:"(plot){19edo}(plot)",color:"pitch",onSetTune:t})]}),Object(y.jsx)(we,{pt:4,children:Object(y.jsx)(He,{children:"Bugs and future features"})}),Object(y.jsxs)(De,{children:["Find anything broken, or have some ideas you want to share? Visit the ",Object(y.jsx)(ze,{target:"_blank",href:"https://github.com/dxinteractive/xenpaper/issues",children:"issue tracker on github"})," to file bugs or discuss future features."]}),Object(y.jsx)(we,{display:["block","block","none"],pt:4,children:Object(y.jsx)(Te,{})})]})},Ce=function(e){var t=e.setSidebar,n=e.url,r=e.urlEmbed,o='<iframe width="560" height="315" src="'.concat(r,'" title="Xenpaper" frameborder="0"></iframe>'),c=Object(u.useState)(!1),i=Object(g.a)(c,2),a=i[0],s=i[1],l=Object(u.useState)(!1),d=Object(g.a)(l,2),h=d[0],b=d[1];return Object(y.jsxs)(Pe,{setSidebar:t,pad:!0,children:[Object(y.jsxs)(we,{children:[Object(y.jsx)(He,{children:"Share link"}),Object(y.jsxs)(ke,{children:[Object(y.jsx)(Ne,{value:n}),Object(y.jsx)(we,{flexShrink:"0",ml:3,children:Object(y.jsx)(Ee.CopyToClipboard,{text:n,onCopy:function(){return s(!0)},children:Object(y.jsx)(Ie,{children:a?"Copied":"Copy"})})})]})]}),Object(y.jsxs)(we,{pt:4,children:[Object(y.jsx)(He,{children:"Embed"}),Object(y.jsxs)(ke,{children:[Object(y.jsx)(Ne,{value:o}),Object(y.jsx)(we,{flexShrink:"0",ml:3,children:Object(y.jsx)(Ee.CopyToClipboard,{text:n,onCopy:function(){return b(!0)},children:Object(y.jsx)(Ie,{children:h?"Copied":"Copy"})})})]}),Object(y.jsx)(we,{pt:3,children:Object(y.jsx)(Re,{src:r,frameBorder:"0"},r)})]})]})},Re=x.d.iframe(q||(q=Object(f.a)(["\n    width: 100%;\n"]))),Ne=x.d.input.attrs((function(){return{readOnly:!0}}))(I||(I=Object(f.a)(["\n    width: 100%;\n    background-color: ",";\n    font-family: ",";\n    color: #ffffff;\n    padding: .25rem;\n    border: "," 1px solid;\n"])),(function(e){return e.theme.colors.background.normal}),(function(e){return e.theme.fonts.mono}),(function(e){return e.theme.colors.highlights[e.color||"unknown"]})),Pe=function(e){var t=e.setSidebar,n=e.children,r=e.title,o=e.desc,c=e.pad;return Object(y.jsxs)(_e,{width:["auto","20rem","30rem","40%"],flexDirection:"column",flexShrink:"0",minHeight:"0",height:["66vh","auto"],children:[Object(y.jsx)(we,{position:["absolute","fixed"],top:0,right:0,pt:3,pr:3,children:Object(y.jsx)(se,{state:"cross",paths:{cross:["M 1 0 L 12 11 L 11 12 L 0 1 Z","M 1 12 L 12 1 L 11 0 L 0 11 Z"],none:[]},onClick:function(){return t("none")},loaded:!0})}),Object(y.jsxs)(Ae,{children:[r&&Object(y.jsx)(Ge,{children:r}),o&&Object(y.jsx)(ue,{as:"div",color:"text.placeholder",style:{fontStyle:"italic",lineHeight:"1.3rem"},children:o}),!r&&Object(y.jsxs)(ke,{alignItems:"center",children:[Object(y.jsx)(we,{mr:4,width:"5rem",pt:2,children:Object(y.jsx)("img",{alt:"Xenpaper logo",src:Se,width:"100%"})}),Object(y.jsxs)(we,{children:[Object(y.jsx)(Le,{children:"xenpaper"}),Object(y.jsx)(ue,{as:"div",color:"text.placeholder",style:{fontStyle:"italic",lineHeight:"1.3rem"},children:"Text-based microtonal sequencer."}),Object(y.jsx)(ue,{as:"div",color:"text.placeholder",style:{fontStyle:"italic",lineHeight:"1.3rem"},children:"Write down musical ideas and share the link around."})]})]})]}),Object(y.jsx)(we,{p:c?4:0,flexGrow:"1",children:n})]})},_e=Object(x.d)(ke)(B||(B=Object(f.a)(["\n    background-color: ",";\n    font-family: ",";\n    position: relative;\n    animation: .3s ease-out onShow;\n    position: relative;\n    overflow: auto;\n\n    opacity: 1;\n    top: 0;\n\n    @keyframes onShow {\n        0% {\n            opacity: 0;\n            top: .25rem;\n        }\n        100% {\n            opacity: 1;\n            top: 0;\n        }\n    }\n"])),(function(e){return e.theme.colors.background.light}),(function(e){return e.theme.fonts.copy})),Ae=Object(x.d)(we)(V||(V=Object(f.a)(["\n    background-color: ",";\n    padding: 2rem 2rem 1.5rem;\n"])),(function(e){return e.theme.colors.background.normal})),Le=Object(x.d)(we)(U||(U=Object(f.a)(["\n    font-size: 2.5rem;\n    line-height: 2rem;\n    margin-bottom: .5rem;\n"]))),De=x.d.div(W||(W=Object(f.a)(["\n    margin-bottom: 2rem;\n"]))),He=x.d.h2(Y||(Y=Object(f.a)(["\n    font-size: 1.5rem;\n    margin-bottom: 1rem;\n"]))),Ge=x.d.h2(X||(X=Object(f.a)(["\n    font-size: 1.5rem;\n    margin-bottom: .25rem;\n"]))),Fe=x.d.span(Z||(Z=Object(f.a)(["\n    font-family: ",";\n    background-color: ",";\n    padding: .1rem;\n"])),(function(e){return e.theme.fonts.mono}),(function(e){return e.theme.colors.background.normal})),qe=Object(x.d)((function(e){return Object(y.jsxs)(ke,{className:e.className,children:[Object(y.jsx)(Be,{children:"e.g. "}),Object(y.jsx)(Ve,{fontSize:["1.1rem","1.4rem"],color:e.color,children:e.tune}),Object(y.jsx)(we,{flexShrink:"0",children:Object(y.jsx)(Ie,{onClick:function(){return e.onSetTune(e.tune)},children:"Demo"})})]})}))(K||(K=Object(f.a)(["\n    font-family: ",";\n    padding: .5rem;\n    margin-top: 1rem;\n    background-color: ",";\n    line-height: 2em;\n"])),(function(e){return e.theme.fonts.mono}),(function(e){return e.theme.colors.background.normal})),Ie=x.d.button(J||(J=Object(f.a)(["\n    border: none;\n    display: block;\n    padding: .5rem;\n    cursor: pointer;\n    background-color: ",";\n    color: ",";\n    position: relative;\n    outline: none;\n    opacity: 0.7;\n\n    transition: opacity .2s ease-out;\n\n    &:hover, &:focus, &:active {\n        opacity: 1;\n    }\n"])),(function(e){return e.theme.colors.highlights.scale}),(function(e){return e.theme.colors.background.normal})),Be=x.d.div(Q||(Q=Object(f.a)(["\n    font-style: italic;\n    color: ",";\n    padding-left: .6rem;\n    padding-right: 1rem;\n    flex-shrink: 0;\n"])),(function(e){return e.theme.colors.text.placeholder})),Ve=x.d.pre($||($=Object(f.a)(["\n    flex-grow: 1;\n    ","\n    ","\n    line-height: 1.4em;\n    font-style: normal;\n    color: ",";\n    word-wrap: break-word;\n    white-space: pre-wrap;\n    flex-shrink: 1;\n    width: 0;\n    padding-right: .5rem;\n"])),le.j,le.k,(function(e){return e.theme.colors.highlights[e.color||"unknown"]})),Ue=n(14),We=n(45),Ye=n(36),Xe=n(26),Ze=n(29),Ke=n.n(Ze),Je=n(0),Qe=n(1),$e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return et(e,1200,2,t)},et=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Math.pow(n,(e+r*t)/t)},tt=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Math.log(e)/Math.log(n)*t-r*t},nt=function(e){return e.slice().sort((function(e,t){return e.time<t.time?-1:e.time>t.time?1:0}))},rt=function(e,t,n){var r=e/60,o=t/60;return r===o?n/o*1e3:2*n*(o-r)/(o*o-r*r)*1e3},ot=function(e){var t=[];t.push({bpm:60,bpmEnd:60,time:0,ms:0});var n=e.filter((function(e){return"TEMPO"===e.type}));return nt(n).forEach((function(e,n,r){var o=t[t.length-1],c=r[n+1],i=rt(o.bpm,o.bpmEnd,e.time-o.time)+o.ms,a=c&&c.lerp?c.bpm:e.bpm;t.push({bpm:e.bpm,bpmEnd:a,time:e.time,ms:i})})),function(e){var n=function(e,t){for(var n=e.length-1;n>=0;n--)if(t>=e[n].time)return e[n];return e[0]}(t,e);return rt(n.bpm,n.bpmEnd,e-n.time)+n.ms}},ct=function(){function e(){Object(Je.a)(this,e),this.scoreMs=void 0,this.events={end:new Set,note:new Set}}return Object(Qe.a)(e,[{key:"playing",value:function(){return!1}},{key:"looping",value:function(){return!1}},{key:"position",value:function(){return 0}},{key:"endPosition",value:function(){return 0}},{key:"play",value:function(){var e=Object(O.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"pause",value:function(){var e=Object(O.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"gotoMs",value:function(){var e=Object(O.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setLoop",value:function(e){}},{key:"setLoopActive",value:function(e){}},{key:"setLoopStart",value:function(){}},{key:"setLoopEnd",value:function(){}},{key:"setScore",value:function(){var e=Object(O.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_triggerEvent",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.events[e].forEach((function(e){return e.apply(void 0,n)}))}},{key:"onEnd",value:function(e){var t=this;return this.events.end.add(e),function(){t.events.end.delete(e)}}},{key:"onNote",value:function(e){var t=this;return this.events.note.add(e),function(){t.events.note.delete(e)}}}]),e}();Object(Ye.useStrictMode)(!0);var it,at=Ye,st=at.Stage,lt=at.Layer,ut=(at.Rect,at.Group),dt=at.Text,ht=at.Line;!function(e){e.GRADIENT="GRADIENT",e.NEAR_NOTES_SOFT="NEAR_NOTES_SOFT",e.NEAR_NOTES_HARD="NEAR_NOTES_HARD"}(it||(it={}));var bt=function(e){return Math.log2(e/20)},jt=function(e){return 20*Math.pow(2,e)},ft=function(e){return 1200*e},pt=function(e,t,n,r){return t-(e-.5*r)/r*n},mt=function(e,t){var n=Object(g.a)(t,2),r=n[0],o=n[1];return e>=r&&e<=o},vt=function(e){var t=e.label.match(/([\d.]+)c/);if(!t)return Ke()(0,100,66);var n=Math.floor(Number(t[1])/1200*360+180);return Ke()(n,100,66)};function Ot(e){var t=e.rulerState,n=Object(u.useCallback)((function(){t.set((function(e){e.notes.clear()}))}),[]);return Object(y.jsxs)(ke,{flexDirection:"column",style:{height:"100%"},children:[Object(y.jsxs)(ke,{pt:2,px:2,flexWrap:"wrap",children:[Object(y.jsxs)(ke,{flexShrink:0,pb:2,children:[Object(y.jsx)(we,{mr:3,children:t.render("collect",(function(e){return Object(y.jsxs)(yt,{children:[Object(y.jsx)("input",Object(p.a)({type:"checkbox"},Object(Xe.a)(e))),Object(y.jsx)(we,{as:"span",ml:2,children:"collect"})]})}))}),Object(y.jsx)(we,{mr:3,children:Object(y.jsx)(wt,{onClick:n,children:"clear"})})]}),Object(y.jsx)(ke,{flexShrink:0,pb:2,children:t.render("colourMode",(function(e){return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(we,{mr:3,children:Object(y.jsxs)(yt,{children:[Object(y.jsx)(we,{as:"span",mr:2,children:"colour"}),Object(y.jsxs)("select",Object(p.a)(Object(p.a)({},Object(Xe.c)(e)),{},{children:[Object(y.jsx)("option",{value:it.GRADIENT,children:"Gradient"}),Object(y.jsx)("option",{value:it.NEAR_NOTES_SOFT,children:"Near notes (soft)"}),Object(y.jsx)("option",{value:it.NEAR_NOTES_HARD,children:"Near notes (hard)"})]}))]})}),e.useValue()!==it.GRADIENT&&Object(y.jsx)(we,{mr:3,children:t.render("colourModeThreshold",(function(e){return Object(y.jsxs)(yt,{children:[Object(y.jsx)(we,{as:"span",mr:2,children:"threshold"}),Object(y.jsx)("input",{type:"number",value:"".concat(e.useValue()),onChange:function(t){return e.set(Number(t.target.value))},min:"1",max:"100",step:"1"})]})}))})]})}))})]}),Object(y.jsx)(gt,Object(p.a)({},e))]})}function gt(e){var t=Object(We.a)(),n=Object(g.a)(t,2),r=n[0],o=n[1],c=o.width,i=void 0===c?0:c,a=o.height,s=void 0===a?0:a,l=e.rulerState.useValue(),d=l.viewPan,h=l.viewZoom,b=l.rootHz,j=l.octaveSize,f=l.plots,p=void 0===f?[]:f,m=l.notes,v=l.notesActive,O=l.colourMode,x=l.colourModeThreshold,w=[jt(pt(s,d,h,s)),jt(pt(0,d,h,s))],k=(i-60)/(p.length+1),S=Object(u.useCallback)((function(e){return function(e,t,n,r){return.5*r-(e-t)*r/n}(bt(e),d,h,s)}),[d,h,s]),E=Object(u.useCallback)((function(e){return O===it.GRADIENT?vt(e):function(e,t,n,r){var o=ft(bt(e.hz)),c=Math.min.apply(Math,Object(Ue.a)(t.map((function(e){return ft(bt(e.hz))})).map((function(e){return Math.abs(o-e)}))))/n;return r&&(c=c>1?1e3:c),Ke()(Math.round(360-80*Math.min(c,2)),100,Math.round(50*Math.max(1-.5*c,0)+10))}(e,Array.from(m.values()),x,O===it.NEAR_NOTES_HARD)}),[O,x,m]),z=Object(u.useRef)(null),T=Object(u.useState)(!1),M=Object(g.a)(T,2),C=M[0],R=M[1],N=Object(u.useCallback)((function(e){var t=e.evt;t.preventDefault(),z.current={startPan:d,startZoom:h,startDrag:pt(t.clientY,d,h,s)},R(!0)}),[d,h,s]),P=Object(u.useCallback)((function(t){var n=t.evt;n.preventDefault();var r=z.current;if(r){var o=pt(n.clientY,r.startPan,r.startZoom,s);e.rulerState.set((function(e){e.viewPan=r.startPan-o+r.startDrag}))}}),[s]);Object(u.useEffect)((function(){var e=function(){z.current=null,R(!1)};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}}),[]);var _=Object(u.useCallback)((function(t){var n=t.evt;n.preventDefault(),e.rulerState.set((function(e){e.viewZoom*=n.deltaY>0?1.1:n.deltaY<0?1/1.1:1}))}),[]),A=Object(u.useCallback)((function(e){e.evt.preventDefault()}),[]),L=Object(u.useCallback)((function(e){e.evt.preventDefault()}),[]),D=(Object(u.useCallback)((function(e){e.evt.preventDefault()}),[]),{height:"100%",width:"100%",backgroundColor:"#080b0e",cursor:C?"grabbing":"grab"});return Object(y.jsx)("div",{ref:r,style:D,children:Object(y.jsx)(st,{width:i,height:s,onMouseDown:N,onMouseMove:P,onWheel:_,onTouchStart:A,onTouchMove:L,children:Object(y.jsxs)(lt,{children:[b&&j&&Object(y.jsx)(zt,{rootHz:b,octaveSize:j,getY:S,width:i,visibleRange:w}),b&&j&&Object(y.jsx)(St,{rootHz:b,octaveSize:j,getY:S,width:i,visibleRange:w}),l.collect&&Object(y.jsx)(xt,{notes:Array.from(m.values()),getY:S,width:k,x:0,visibleRange:w}),(p||[]).map((function(e,t){return Object(y.jsx)(xt,{notes:e,getY:S,width:k,x:k*(t+1),visibleRange:w,getColor:E},t)})),Object(y.jsx)(xt,{notes:Array.from(v.values()),getY:S,color:"#FFFFFF",width:k,x:0,visibleRange:w})]})})})}var xt=d.a.memo((function(e){var t=e.width,n=e.notes,r=e.getColor,o=void 0===r?vt:r,c=e.getY,i=e.x,a=e.visibleRange,s=n.filter((function(e){return mt(e.hz,a)}));return Object(y.jsx)(y.Fragment,{children:s.map((function(n,r){var a,s=null!==(a=e.color)&&void 0!==a?a:o(n);return Object(y.jsxs)(ut,{x:i,y:c(n.hz),children:[Object(y.jsx)(ht,{stroke:s,strokeWidth:1,points:[0,0,t,0]}),Object(y.jsx)(dt,{text:n.label,fill:s,align:"center",width:t,y:-13})]},r)}))})})),yt=x.d.label(ee||(ee=Object(f.a)(["\n    user-select: none;\n"]))),wt=x.d.button(te||(te=Object(f.a)(["\n    border: none;\n    display: block;\n    padding: .25rem .5rem;\n    cursor: pointer;\n    background-color: ",";\n    color: ",";\n    position: relative;\n    outline: none;\n    opacity: 0.7;\n\n    transition: opacity .2s ease-out;\n\n    &:hover, &:focus, &:active {\n        opacity: 1;\n    }\n"])),(function(e){return e.theme.colors.highlights.unknown}),(function(e){return e.theme.colors.background.normal})),kt=[7,6,5,4,3,2,1,0,-1,-2,-3],St=d.a.memo((function(e){var t=e.getY,n=e.rootHz,r=e.octaveSize,o=e.width,c=e.visibleRange,i=kt.map((function(e){return[e,n*Math.pow(r,e)]})).filter((function(e){var t=Object(g.a)(e,2)[1];return mt(t,c)}));return Object(y.jsx)(y.Fragment,{children:i.map((function(e){var n=Object(g.a)(e,2),r=n[0],c=n[1],i=t(c);return Object(y.jsxs)(ut,{y:i,children:[Object(y.jsx)(ht,{stroke:Ke()(208,32,12*(8-Math.abs(r))),strokeWidth:1,points:[0,0,o-60,0],dash:[4,4]}),Object(y.jsx)(dt,{text:"".concat(c,"Hz"),fill:Ke()(208,32,24*(8-Math.abs(r))),align:"left",width:55,x:o-55,y:-5})]},r)}))})})),Et=[1,0,-1],zt=d.a.memo((function(e){var t=e.getY,n=e.rootHz,r=e.octaveSize,o=e.width,c=e.visibleRange,i=[];return Et.forEach((function(e){for(var t=100;t<600*r;t+=100){var o=n*$e(t,e);mt(o,c)&&i.push([t,o,e])}})),Object(y.jsx)(y.Fragment,{children:i.map((function(e){var n=Object(g.a)(e,3),r=n[0],c=n[1],i=n[2],a=t(c);return Object(y.jsxs)(ut,{y:a,children:[Object(y.jsx)(ht,{stroke:Ke()(208,32,12*(2-Math.abs(i))),strokeWidth:1,points:[0,0,o-60,0]}),Object(y.jsx)(dt,{text:"".concat(r,"c"),fill:Ke()(208,32,24*(2-Math.abs(i))),align:"left",width:55,x:o-55,y:-5})]},c)}))})})),Tt=n(17);function Mt(e,t,n){return Object(Tt.c)(t,(function(t,r){return Object(p.a)(Object(p.a)({type:e,delimiter:!1},n(t)),{},{pos:r.pos})}))}var Ct=function(e){return e.reduce((function(e,t){return e+t.len}),0)},Rt=function(e){return{delimiter:!0,len:Object(g.a)(e,1)[0].length}},Nt=Mt("Semicolon",/(^[;]\s*)/,Rt),Pt=Mt("Colon",/(^[:]\s*)/,Rt),_t=Mt("BarLine","|",(function(){return{len:1,delimiter:!0}})),At=Mt("Whitespace",/(^[,\s]+)/,(function(e){return{len:Object(g.a)(e,1)[0].length,delimiter:!0}})),Lt=Mt("OctaveModifier",/^(['"]+|`+)/,(function(e){var t=Object(g.a)(e,1)[0];return{octave:t.split("'").length-1+2*(t.split('"').length-1)-(t.split("`").length-1),len:t.length}})),Dt=Mt("PitchCents",/^(\d+|\d+\.(\d+)?)c/,(function(e){var t=Object(g.a)(e,1)[0];return{cents:Number(t),len:t.length+1}})),Ht=Mt("PitchOctaveDivision",/^([\d]+)[\\/]([\d]+)o(\d)?(\/(\d))?/,(function(e){var t=Object(g.a)(e,5),n=t[0],r=t[1],o=t[2],c=void 0===o?"":o,i=t[3],a=void 0===i?"":i,s=t[4],l=void 0===s?"":s;return{numerator:Number(n),denominator:Number(r),octaveSize:Number(c||2)/Number(l||1),len:n.length+r.length+c.length+2+a.length}})),Gt=Mt("PitchOctaveDivision",/^([\d]+)[\\]([\d]+)/,(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{numerator:Number(n),denominator:Number(r),octaveSize:2,len:n.length+r.length+1}})),Ft=Mt("PitchRatio",/^([\d]+)\/([\d]+)/,(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{numerator:Number(n),denominator:Number(r),len:n.length+r.length+1}})),qt=Mt("PitchDegree",/^([\d]+)/,(function(e){var t=Object(g.a)(e,1)[0];return{degree:Number(t),len:t.length}})),It=Mt("PitchHz",/^(\d+|\d+\.(\d+)?)hz/i,(function(e){var t=Object(g.a)(e,1)[0];return{hz:Number(t),len:t.length+2}})),Bt=Mt("Pitch",Object(Tt.a)(Object(Tt.d)(Lt),Object(Tt.b)(Dt,It,Ht,Gt,Ft,qt)),(function(e){if(1===e.length){var t=Object(g.a)(e,1)[0];return{value:t,len:t.len}}var n=Object(g.a)(e,2),r=n[0],o=n[1];return{value:o,octave:r,len:r.len+o.len}})),Vt=Object(Tt.c)(Object(Tt.a)(Bt,Object(Tt.e)(Object(Tt.a)(At,Bt))),(function(e){return e})),Ut=Mt("Hold",/^(([|]?-)+)/,(function(e){var t=Object(g.a)(e,1)[0];return{length:t.replace(/[|]+/g,"").length,len:t.length}})),Wt=Object(Tt.b)(Ut),Yt=Mt("Rest",Object(Tt.a)(/^(\.)/),(function(e){var t=Object(g.a)(e,1)[0];return{length:t.length,len:t.length}})),Xt=Mt("Note",Object(Tt.a)(Bt,Object(Tt.d)(Wt)),(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{pitch:n,tail:r,len:n.len+(r?r.len:0)}})),Zt=Mt("RatioChordPitch",/^([\d]+)/,(function(e){var t=Object(g.a)(e,1)[0];return{pitch:Number(t),len:t.length}})),Kt=Object(Tt.c)(Object(Tt.a)(Zt,Pt,Zt,Object(Tt.e)(Object(Tt.a)(Pt,Zt))),(function(e){return e})),Jt=Mt("Chord",Object(Tt.a)("[",Object(Tt.b)(Kt,Vt),"]",Object(Tt.d)(Wt)),(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{pitches:n,tail:r,len:Ct(n)+(r?r.len:0)+2}})),Qt=Mt("RatioChord",Object(Tt.a)(Kt,Object(Tt.d)(Wt)),(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{pitches:n,tail:r,len:Ct(n)+(r?r.len:0)}})),$t=Mt("EdoScale",/^(\d+)ed([o\d])(\/(\d))?/i,(function(e){var t=Object(g.a)(e,4),n=t[0],r=t[1],o=t[2],c=void 0===o?"":o,i=t[3],a=void 0===i?"":i;return{divisions:Number(n),octaveSize:"o"===r?2:Number(r)/Number(a||1),len:n.length+r.length+2+c.length}})),en=Mt("ScaleOctaveMarker","'",(function(){return{len:1}})),tn=Mt("PitchGroupScalePrefix",/(^[m])(\s*)/,(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{prefix:n,len:n.length+(r?r.length:0)}})),nn=Mt("PitchGroupScale",Object(Tt.a)(Object(Tt.d)(tn),Vt,Object(Tt.d)(en)),(function(e){var t=Array.isArray(e[0])?[void 0].concat(Object(Ue.a)(e)):e,n=Object(g.a)(t,3),r=n[0],o=n[1],c=n[2];return{pitchGroupScalePrefix:r,pitches:o,scaleOctaveMarker:c,len:(r?r.len:0)+Ct(o)+(c?c.len:0)}})),rn=Mt("RatioChordScale",Object(Tt.a)(Kt,Object(Tt.d)(en)),(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{pitches:n,scaleOctaveMarker:r,len:Ct(n)+(r?r.len:0)}})),on=Object(Tt.b)($t,rn,nn),cn=Mt("SetScale",Object(Tt.a)("{",on,"}"),(function(e){var t=Object(g.a)(e,1)[0];return{scale:t,len:t.len+2}})),an=Mt("SetRoot",Object(Tt.a)("{r",Bt,"}"),(function(e){var t=Object(g.a)(e,1)[0];return{pitch:t,len:t.len+3}})),sn=Mt("SetBpmValue",/^(\d+(\.\d+)?)/,(function(e){var t=Object(g.a)(e,1)[0];return{bpm:Number(t),len:t.length}})),ln=Mt("SetBpm",Object(Tt.a)(/^(bpm:\s*)/,sn),(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{bpm:r.bpm,len:n.length+r.len}})),un=Mt("SetBmsValue",/^(\d+(\.\d+)?)/,(function(e){var t=Object(g.a)(e,1)[0];return{bms:Number(t),len:t.length}})),dn=Mt("SetBms",Object(Tt.a)(/^(bms:\s*)/,un),(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{bms:r.bms,len:n.length+r.len}})),hn=Mt("SetSubdivisionValue",/^([\d]+)(\/(\d))?/,(function(e){var t=Object(g.a)(e,3),n=t[0],r=t[1],o=void 0===r?"":r,c=t[2],i=void 0===c?"":c;return{subdivision:Number(n),denominator:i?Number(i):void 0,len:n.length+o.length}})),bn=Mt("SetSubdivision",Object(Tt.a)(/^((div:)?\s*)/,hn),(function(e){var t=Object(g.a)(e,3),n=t[0],r=t[2];return{subdivision:r.subdivision,denominator:r.denominator,len:n.length+r.len}})),jn=Mt("SetOscValue",/^([a-z0-9]*)/,(function(e){var t=Object(g.a)(e,1)[0];return{osc:t,len:t.length}})),fn=Mt("SetOsc",Object(Tt.a)(/^(osc:\s*)/,jn),(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{osc:r.osc,len:n.length+r.len}})),pn=Mt("SetEnvValue",/^(([0-9])([0-9])([0-9])([0-9]))/,(function(e){var t=Object(g.a)(e,5),n=t[0],r=t[1],o=t[2],c=t[3],i=t[4];return{a:Number(r),d:Number(o),s:Number(c),r:Number(i),len:n.length}})),mn=Mt("SetEnv",Object(Tt.a)(/^(env:\s*)/,pn),(function(e){var t=Object(g.a)(e,2),n=t[0],r=t[1];return{a:r.a,d:r.d,s:r.s,r:r.r,len:n.length+r.len}})),vn=Mt("SetRulerRange",Object(Tt.a)(/^(rl:)/,Bt,",",Bt),(function(e){var t=Object(g.a)(e,3),n=t[0],r=t[1],o=t[2];return{low:r,high:o,len:n.length+1+r.len+o.len}})),On=Mt("SetRulerPlot","plot",(function(){return{len:4}})),gn=Object(Tt.b)(vn,On),xn=Object(Tt.b)(ln,dn,bn,fn,mn,gn),yn=Mt("SetterGroup",Object(Tt.a)("(",xn,Object(Tt.e)(Object(Tt.a)(Nt,xn)),")"),(function(e){return{setters:e,len:Ct(e)+2}})),wn=Mt("Comment",/^#([^\n]*)/,(function(e){var t=Object(g.a)(e,1)[0];return{comment:t,len:t.length+1}})),kn=Mt("Sequence",Object(Tt.e)(Object(Tt.b)(wn,Qt,Xt,Jt,Yt,yn,cn,an,_t,At)),(function(e){return{items:e,len:Ct(e)}})),Sn=Mt("ParamEmbed","embed",(function(){return{len:5}})),En=Object(Tt.b)(Sn),zn=Mt("ParamGroup",Object(Tt.a)(En,Object(Tt.e)(Object(Tt.a)(Nt,En)),":"),(function(e){return{params:e,len:Ct(e)+1}})),Tn=Mt("XenpaperGrammar",Object(Tt.a)(Object(Tt.d)(zn),Object(Tt.d)(kn)),(function(e){var t=e.find((function(e){return"ParamGroup"===e.type})),n=e.find((function(e){return"Sequence"===e.type}));return{sequence:n,paramGroup:t,len:n?n.len:0}})),Mn=Object(Tt.f)(Tn),Cn=new Map([["Semicolon","delimiter"],["Colon","delimiter"],["Pitch","pitch"],["RatioChordPitch","pitch"],["Chord","chord"],["Chord.Whitespace","pitch"],["Hold","pitch"],["Rest","delimiter"],["BarLine","delimiter"],["Whitespace","delimiter"],["EdoScale","scale"],["PitchGroupScale","scale"],["PitchGroupScale.Pitch","scale"],["PitchGroupScale.Whitespace","scale"],["RatioChordScale","scale"],["RatioChordScale.RatioChordPitch","scale"],["RatioChordScale.Colon","scale"],["ScaleOctaveMarker","scale"],["SetScale","scaleGroup"],["SetRoot","scaleGroup"],["SetRoot.Pitch","scale"],["SetBpm","setter"],["SetBms","setter"],["SetSubdivision","setter"],["SetOsc","setter"],["SetEnv","setter"],["SetRulerPlot","setter"],["SetRulerRange","setter"],["SetRulerRange.Pitch","setter"],["SetterGroup","setterGroup"],["SetterGroup.Semicolon","setterGroup"],["Comment","comment"]]),Rn=function e(t,n,r,o){if(Array.isArray(n))n.forEach((function(n){return e(t,n,r,o)}));else if(n instanceof Object){var c=Cn.get("".concat(r,".").concat(n.type))||Cn.get(n.type),i=null!==o&&void 0!==o?o:n.time;if("number"===typeof n.pos&&"number"===typeof n.len&&c)for(var a=0;a<n.len;a++)t[n.pos+a]={color:"comment"===c&&0===a?"commentStart":c,playTime:i};Object.keys(n).forEach((function(r){e(t,n[r],n.type,i)}))}else;},Nn=function(e){var t=e.sequence;if(!t)return[];var n=t.items,r=[];return Rn(r,n,""),r},Pn=function(e,t,n,r){if(t<n||t>r)throw new Error("".concat(e," must be between ").concat(n," and ").concat(r,", got ").concat(t))},_n=function(e,t){var n,r=t.scale,o=t.octaveSize;Pn("Octave size",o,-20,20);var c=e.value.type,i=Math.pow(o,(null===e||void 0===e||null===(n=e.octave)||void 0===n?void 0:n.octave)||0);if("PitchRatio"===c){var a=e.value,s=a.numerator/a.denominator;return Pn("Pitch ratio",s,0,100),s*i}if("PitchCents"===c){var l=e.value.cents;return Pn("Cents",l,-12e3,12e3),$e(l)*i}if("PitchOctaveDivision"===c){var u=e.value,d=u.numerator,h=u.denominator,b=u.octaveSize;return et(d,h,b)*i}if("PitchDegree"===c){var j=e.value.degree;return Dn(j,r,o)*i}throw new Error('Unknown pitch type "'.concat(c,'"'))},An=function(e,t){for(var n=[],r=0;r<e;r++)n.push(et(r,e,t));return n},Ln=function(e,t){Pn("Scale degree",e,-1e3,1e3);for(var n=t.length,r=0;e>=n&&r>-20;)e-=n,r++;for(;e<0&&r<20;)e+=n,r--;return[e,r]},Dn=function(e,t,n){if(Pn("Octave size",n,-20,20),0===t.length)return 1;var r=Ln(e,t),o=Object(g.a)(r,2),c=o[0],i=o[1];return t[c]*Math.pow(n,i)},Hn=function(e,t){if("PitchHz"===e.value.type){var n,r=Math.pow(t.octaveSize,(null===e||void 0===e||null===(n=e.octave)||void 0===n?void 0:n.octave)||0),o=e.value.hz*r;return Pn("Hz",o,0,2e4),o}return _n(e,t)*t.rootHz},Gn=function(e,t){var n=t.time,r=e&&"Hold"===e.type?e.length+1:1;return t.time+=r*t.subdivision,{time:n,timeEnd:t.time}},Fn=function(e,t){return"".concat(function(e){return tt(e,1200,2,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)}(function(e,t){for(;e<1;)e*=t;for(;e>t;)e/=t;return e}(e,t)).toFixed(1),"c")},qn=function(e,t){var n=e.value.type;if("PitchHz"===n){var r=e.value.hz;return"".concat(r,"Hz")}if("PitchCents"===n){var o=e.value.cents;return"".concat(o,"c")}var c=Fn(_n(e,t),t.octaveSize);if("PitchRatio"===n){var i=e.value,a=i.numerator,s=i.denominator;return"".concat(a,"/").concat(s,"  ").concat(c)}if("PitchOctaveDivision"===n){var l=e.value,u=l.numerator,d=l.denominator;return"".concat(u,"\\").concat(d,"  ").concat(c)}if("PitchDegree"===n){var h=e.value.degree,b=Ln(h,t.scale),j=Object(g.a)(b,1)[0];return t.scaleLabels[j]}throw new Error('Unknown pitch type "'.concat(n,'"'))},In=function(e,t,n){for(var r=[],o=0;o<e;o++){var c=Fn(t[o],n);r.push("".concat(o,"\\").concat(e,"  ").concat(c))}return r},Bn=[0,.003,.006,.01,.033,.1,.33,1,3.3,10],Vn=[],Un=function(e,t){var n=e.tail,r=e.pitches,o=Gn(n,t),c=[o.time,o.timeEnd];Vn.push(c),e.time=c;var i=r.filter((function(e){return"Pitch"===e.type})).map((function(e){var n=Hn(e,t),r=qn(e,t);return Object(p.a)({type:"NOTE_TIME",hz:n,label:r},o)})),a=r.find((function(e){return"RatioChordPitch"===e.type})),s=r.filter((function(e){return"RatioChordPitch"===e.type})).map((function(e){var n=e.pitch,r=a.pitch;return Object(p.a)({type:"NOTE_TIME",hz:n/r*t.rootHz,label:"".concat(n,"/").concat(r,"  ").concat(Fn(n/r,t.octaveSize))},o)}));return i.concat(s)},Wn=function(e,t){return e.rootHz?e:Object(p.a)(Object(p.a)({},e),{},{rootHz:t.rootHz,octaveSize:t.octaveSize})},Yn=function(e){var t=e.sequence;if(!t)return{};var n={type:"PARAM_TIME",time:0,value:{type:"env",a:Bn[2],d:Bn[8],s:.5,r:Bn[6]}},r=An(12,2),o={rootHz:220,time:0,subdivision:.5,scale:r,scaleLabels:In(12,r,2),octaveSize:2},c=[],i={plots:[]};t.items.forEach((function(e){var t=e.type;if("Comment"!==t&&"BarLine"!==t&&"Whitespace"!==t)if("SetScale"!==t)if("SetRoot"!==t){if("Note"===t)return c.push.apply(c,Object(Ue.a)(function(e,t){var n=Gn(e.tail,t),r=[n.time,n.timeEnd];Vn.push(r),e.time=r;var o=Hn(e.pitch,t),c=qn(e.pitch,t);return[Object(p.a)({type:"NOTE_TIME",hz:o,label:c},n)]}(e,o))),void(i=Wn(i,o));if("Rest"===t){var n=o.time,r=e;o.time+=r.length*o.subdivision;var a=[n,o.time];return Vn.push(a),void(r.time=a)}if("Chord"!==t){if("RatioChord"===t)return c.push.apply(c,Object(Ue.a)(Un(e,o))),void(i=Wn(i,o));if("SetterGroup"!==t)throw new Error('Unknown sequence item "'.concat(t,'"'));e.setters.forEach((function(e){c.push.apply(c,Object(Ue.a)(function(e,t){var n=e.type;if(e.delimiter)return[];if("SetBpm"===n){var r=e.bpm;return[{type:"TEMPO",time:t.time,bpm:r,lerp:!1}]}if("SetBms"===n){var o=e.bms;return[{type:"TEMPO",time:t.time,bpm:6e4/o,lerp:!1}]}if("SetSubdivision"===n){var c=e,i=c.subdivision,a=c.denominator;return t.subdivision=(null!==a&&void 0!==a?a:1)/i,[]}if("SetOsc"===n){var s=e.osc;return[{type:"PARAM_TIME",time:t.time,value:{type:"osc",osc:s}}]}if("SetEnv"===n){var l=e,u=l.a,d=l.d,h=l.s,b=l.r;return[{type:"PARAM_TIME",time:t.time,value:{type:"env",a:Bn[u]||0,d:Bn[d]||0,s:h/9,r:Bn[b]||0}}]}return[]}(e,o))),i=function(e,t,n){var r=t.type;if(t.delimiter)return e;if("SetRulerPlot"===r){var o=n.scale.map((function(e,t){return{type:"NOTE_MS",ms:n.time,msEnd:n.time,hz:e*n.rootHz,label:n.scaleLabels[t]}}));return Object(p.a)(Object(p.a)({},e),{},{plots:[].concat(Object(Ue.a)(e.plots),[o])})}if("SetRulerRange"===r){if(e.lowHz)return e;var c=t,i=c.low,a=c.high;return Object(p.a)(Object(p.a)({},e),{},{lowHz:Hn(i,n),highHz:Hn(a,n)})}return e}(i,e,o)}))}else c.push.apply(c,Object(Ue.a)(Un(e,o)))}else{var s=e.pitch;o.rootHz=Hn(s,o)}else!function(e,t){var n=e.scale,r=n.type;if("PitchGroupScale"===r){var o=n,c=o.pitches,i=o.scaleOctaveMarker,a=o.pitchGroupScalePrefix,s=c.filter((function(e){return!e.delimiter}));if(a&&"m"===a.prefix){var l=[{type:"PitchDegree",degree:0,delimiter:!1,pos:a.pos,len:0}],u=0;s.forEach((function(e){if("PitchDegree"!==e.value.type)throw new Error("Mode scales {m} should only contain pitch degrees (0, 1, etc), not ratios, hz or any other kind of pitch");u+=e.value.degree,l.push(Object(p.a)(Object(p.a)({},e.value),{},{degree:u}))})),l.pop(),s=l.map((function(e){return{value:e}}))}return t.scale=s.map((function(e){return _n(e,t)})),t.scaleLabels=s.map((function(e){return qn(e,t)})),void(i&&(t.octaveSize=t.scale.pop()||2,t.scaleLabels.pop()))}if("EdoScale"===r){var d=n,h=d.divisions,b=d.octaveSize;return t.scale=An(h,b),t.scaleLabels=In(h,t.scale,b),void(t.octaveSize=b)}if("RatioChordScale"===r){var j=n,f=j.pitches,m=j.scaleOctaveMarker,v=f.filter((function(e){return!e.delimiter})).map((function(e){return e.pitch}));return t.scale=v.map((function(e){return e/v[0]})),t.scaleLabels=v.map((function(e){var t=Fn(e/v[0],2);return"".concat(e,"/").concat(v[0],"  ").concat(t)})),void(m&&(t.octaveSize=t.scale.pop()||2,t.scaleLabels.pop()))}throw new Error('Unknown scale type "'.concat(r,'"'))}(e,o)})),i=Wn(i,o);var a=[{type:"TEMPO",time:0,bpm:120,lerp:!1},{type:"PARAM_TIME",time:0,value:{type:"osc",osc:"triangle"}},n].concat(c,[{type:"END_TIME",time:o.time}]),s=ot(a);return Vn.forEach((function(e){e[0]=s(e[0]),e[1]=s(e[1])})),{score:{sequence:a,lengthTime:o.time},initialRulerState:i}},Xn=function(e){return encodeURIComponent(e).replace(/_/g,"%_").replace(/%20/g,"_")},Zn=function(e){return e.split("").reverse().join("")},Kn=function(){var e=Object(u.useState)((function(){var e,t=function(e){return decodeURIComponent(Zn(Zn(e).replace(/_(?!%)/g,Zn("%20"))).replace(/%_/g,"_"))}(window.location.hash.substr(1));!t&&window.localStorage&&(t=null!==(e=window.localStorage.getItem("lasttune"))&&void 0!==e?e:"");return t})),t=Object(g.a)(e,2),n=t[0],r=t[1],o=Object(u.useCallback)((function(){r(window.location.hash)}),[]);Object(u.useEffect)((function(){return window.addEventListener("hashchange",o),function(){window.removeEventListener("hashchange",o)}}),[o]);var c=Object(u.useCallback)((function(e){var t,r=Xn(e);r!==n&&(window.history.replaceState(void 0,void 0,"#"+r),null===(t=window.localStorage)||void 0===t||t.setItem("lasttune",e))}),[n]);return[n,c]},Jn=new Promise((function(e){window.addEventListener("load",(function t(){window.removeEventListener("load",t),e(null)}))})),Qn=n(24),$n=n(3),er=n(2),tr=n(21);function nr(e,t){var n=[];return e.forEach((function(e){return n.push.apply(n,Object(Ue.a)(t(e)))})),n}for(var rr=[],or=1;or<33;or++)rr.push("".concat(or));var cr,ir,ar,sr,lr,ur=nr(["sine","sawtooth","square","triangle"],(function(e){return[e,"fm".concat(e),"am".concat(e),"fat".concat(e)]})),dr=nr(ur,(function(e){return[e].concat(Object(Ue.a)(rr.map((function(t){return"".concat(e).concat(t)}))))})),hr=function(e){Object($n.a)(n,e);var t=Object(er.a)(n);function n(){var e;Object(Je.a)(this,n);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(e=t.call.apply(t,[this].concat(o)))._started=!1,e._endMs=0,e._loopEndMs=0,e._activeNoteEvents=new Set,e.synth=new tr.b(tr.c,{oscillator:{type:"sine",volume:-18},envelope:{attack:.01,sustain:.5,decay:.25,release:.5}}).chain(tr.a),e}return Object(Qe.a)(n,[{key:"playing",value:function(){return"started"===tr.d.state}},{key:"looping",value:function(){return tr.d.loop}},{key:"position",value:function(){return 1e3*tr.d.seconds}},{key:"endPosition",value:function(){return this._endMs}},{key:"start",value:function(){var e=Object(O.a)(v.a.mark((function e(){var t,n=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._started){e.next=7;break}return e.next=3,tr.e();case 3:this._started=!0,t=function(){n.synth.releaseAll(),n._activeNoteEvents.forEach((function(e){n._triggerEvent("note",e,!1)})),n._activeNoteEvents.clear()},tr.d.on("stop",t),tr.d.on("loop",t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(O.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.start();case 2:tr.d.start();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pause",value:function(){var e=Object(O.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.start();case 2:tr.d.stop();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gotoMs",value:function(){var e=Object(O.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:tr.d.seconds=.001*t;case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setLoop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.setLoopActive(e),this.setLoopStart(t),this.setLoopEnd(n)}},{key:"setLoopActive",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];tr.d.loop=e}},{key:"setLoopStart",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;tr.d.loopStart=.001*e}},{key:"setLoopEnd",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._loopEndMs=e,tr.d.loopEnd=.001*(0===e?this._endMs:e)}},{key:"setScore",value:function(){var e=Object(O.a)(v.a.mark((function e(t){var n=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.scoreMs=t,tr.d.cancel(),this.scoreMs.sequence.forEach((function(e){if("NOTE_MS"===e.type){var t=e;return tr.d.schedule((function(e){n.synth.triggerAttackRelease(t.hz,.001*t.msEnd-.001*t.ms,e),n._activeNoteEvents.add(t),n._triggerEvent("note",t,!0)}),.001*t.ms+.1),void tr.d.schedule((function(e){n._activeNoteEvents.delete(t),n._triggerEvent("note",t,!1)}),.001*t.msEnd+.1)}if("PARAM_MS"!==e.type){if("END_MS"===e.type)return n._endMs=e.ms,0===n._loopEndMs&&n.setLoopEnd(0),void tr.d.schedule(Object(O.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!tr.d.loop){e.next=2;break}return e.abrupt("return");case 2:tr.d.stop(),n._triggerEvent("end",void 0);case 4:case"end":return e.stop()}}),e)}))),.001*n._endMs);throw new Error("Unexpected item type ".concat(e.type," encountered"))}var r=e;tr.d.schedule((function(){"osc"===r.value.type&&dr.includes(r.value.osc)&&n.synth.set({oscillator:{type:r.value.osc,volume:-18}}),"env"===r.value.type&&n.synth.set({envelope:{attack:r.value.a,decay:r.value.d,sustain:r.value.s,release:r.value.r}})}),.001*r.ms)}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(ct),br=n(47);Object(Qn.i)(!1),Object(Qn.c)();var jr=new hr,fr=function(e){try{var t=function(e){try{return Mn(e)}catch(t){throw console.error("e",t),new Error(t.message.replace(/Remainder:[\s\S]*/,""))}}(e),n=Yn(t),r=n.score,o=n.initialRulerState,c=Nn(t);if(r){var i=function(e){var t=ot(e.sequence);return{sequence:nt(e.sequence).map((function(e){if("NOTE_TIME"===e.type){var n=e;return{type:"NOTE_MS",hz:n.hz,label:n.label,ms:t(n.time),msEnd:t(n.timeEnd)}}if("PARAM_TIME"===e.type){var r=e;return{type:"PARAM_MS",value:r.value,ms:t(r.time)}}if("END_TIME"===e.type)return{type:"END_MS",ms:t(e.time)}})).filter((function(e){return!!e})),lengthMs:t(e.lengthTime)}}(r);jr.setScore(i)}return{parsed:t,chars:c,score:r,initialRulerState:o,error:""}}catch(p){for(var a,s,l=p.message.match(/Unexpected token at (\d+):(\d+)/),u=l?Number(l[1])-1:-1,d=l?Number(l[2])-1:-1,h=[],b=0,j=0,f=0;f<e.length+40;f++)b===u&&j===d&&(s=f),"\n"===e[f]?(b++,j=0):j++;return"number"===typeof s&&(a=void 0!==e[s]?p.message.replace("Unexpected token ",'Unexpected token "'.concat(e[s],'" ')):p.message,h[s]={color:"error"}),{parsed:void 0,chars:h,score:void 0,initialRulerState:void 0,error:a}}},pr=function(e,t,n){if(0===n)return 0;for(var r=0,o=0,c=e.split(""),i=0;i<c.length;i++){var a,s=c[i],l=null===t||void 0===t?void 0:t[i],u=null!==(a=null===l||void 0===l?void 0:l.playTime)&&void 0!==a?a:[],d=Object(g.a)(u,2)[1];if(void 0!==d&&(r=d),"\n"===s&&++o===n)return r}return 0},mr={paused:["M 0 0 L 12 6 L 0 12 Z"],playing:["M 0 0 L 4 0 L 4 12 L 0 12 Z","M 8 0 L 12 0 L 12 12 L 8 12 Z"]};function vr(){var e=function(){var e=Object(u.useState)(!1),t=Object(g.a)(e,2),n=t[0],r=t[1];return Object(u.useEffect)((function(){Object(O.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn;case 2:return e.next=4,document.fonts.ready;case 4:r(!0);case 5:case"end":return e.stop()}}),e)})))()}),[]),n}();return Object(y.jsx)(S,{children:Object(y.jsx)(Oe,{height:"100vh",loaded:e,children:Object(y.jsx)(Or,{loaded:e})})})}function Or(e){var t=e.loaded,n=Kn(),r=Object(g.a)(n,2),o=r[0],c=r[1],i=Object(Xe.b)((function(){var e=!1,t=o;return t.startsWith("embed:")&&(e=!0,t=t.substr(6)),{tune:t,embed:e,hash:"",url:"",urlEmbed:""}}),{history:300});i.useDerive((function(e){var t=e.tune,n=Xn(t);e.embed&&(t="embed:".concat(t));var r="https://xenpaper.com/#".concat(n),o="https://xenpaper.com/#embed:".concat(n);i.branch("hash").set(t),i.branch("url").set(r),i.branch("urlEmbed").set(o)})),i.branch("hash").useChange((function(e){c(e)}));var a=Object(Xe.b)((function(){return fr(i.value.tune)}));i.useDerive((function(e){a.set(fr(e.tune))}));var s=Object(Xe.b)(!1),l=Object(Xe.b)(0);l.useChange((function(e){jr.setLoopStart(pr(i.value.tune,a.value.chars,e))})),Object(u.useEffect)((function(){return jr.onEnd((function(){s.set(!1)}))}),[]);var d=Object(Xe.b)(!1),h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lowHz,n=e.highHz,r=Object(j.a)(e,["lowHz","highHz"]);return Object(Xe.b)((function(){var e=bt(330),o=1.5;if(t&&n){var c=bt(t),i=bt(n);e=.5*(c+i),o=i-c}return Object(p.a)({notes:new Map,notesActive:new Map,collect:!0,viewPan:e,viewZoom:o,colourMode:it.GRADIENT,colourModeThreshold:15},r)}))}(a.value.initialRulerState);Object(u.useEffect)((function(){return jr.onNote((function(e,t){var n="".concat(e.ms,"-").concat(e.hz);h.set((function(r){t?(r.notesActive.set(n,e),r.notes.set(n,e)):r.notesActive.delete(n)}))}))}),[]),a.branch("initialRulerState").useChange((function(e){h.set((function(t){t.rootHz=null===e||void 0===e?void 0:e.rootHz,t.octaveSize=null===e||void 0===e?void 0:e.octaveSize,t.plots=null===e||void 0===e?void 0:e.plots}))}));var b=Object(u.useCallback)((function(e){a.value.error||(jr.gotoMs(pr(i.value.tune,a.value.chars,l.value)),s.set(e),e?(jr.play(),h.set((function(e){e.notes.clear()}))):jr.pause())}),[]),f=Object(u.useCallback)((function(e){b("paused"===e)}),[]),m=Object(u.useCallback)((function(){var e=!d.value;d.set(e),jr.setLoopActive(e)}),[]);Object(u.useEffect)((function(){var e=function(e){(e.ctrlKey||e.metaKey)&&13===e.keyCode&&b(s.value),(e.ctrlKey||e.metaKey)&&90===e.keyCode&&(e.preventDefault(),e.shiftKey?i.redo():i.undo())};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[]);var x=Object(u.useState)((function(){var e,t;return(null===(e=a.value)||void 0===e||null===(t=e.initialRulerState)||void 0===t?void 0:t.lowHz)?"ruler":"info"})),w=Object(g.a)(x,2),k=w[0],S=w[1],E=Object(u.useCallback)((function(){S((function(e){return"info"!==e?"info":"none"}))}),[]),z=Object(u.useCallback)((function(){S((function(e){return"share"!==e?"share":"none"}))}),[]),T=Object(u.useCallback)((function(){S((function(e){return"ruler"!==e?"ruler":"none"}))}),[]),M=Object(u.useCallback)(function(){var e=Object(O.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.branch("tune").set(t),e.next=3,jr.gotoMs(0);case 3:b(!0);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),C={},R=s.render((function(e){return Object(y.jsx)(se,{state:e.useValue()?"playing":"paused",paths:mr,onClick:f,loaded:t,hoverBackground:!0,large:!i.branch("embed").useValue()})}),[t]),N=i.render((function(e){var t=e.useHistory(),n=t.canUndo,r=t.canRedo;return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(Er,{onClick:e.undo,disabled:!n,children:"Undo"}),Object(y.jsx)(Er,{onClick:e.redo,disabled:!r,children:"Redo"})]})})),P=d.render((function(e){return Object(y.jsx)(Er,{onClick:m,active:e.useValue(),children:"Loop"})})),_=Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)(Er,{onClick:E,children:"Info"}),Object(y.jsx)(Er,{onClick:z,children:"Share"}),Object(y.jsx)(Er,{onClick:T,children:"Ruler"})]}),A=Object(y.jsxs)(y.Fragment,{children:["info"===k&&Object(y.jsx)(Me,{onSetTune:M,setSidebar:S}),"share"===k&&i.render((function(e){var t=e.branch("url").useValue(),n=e.branch("urlEmbed").useValue();return Object(y.jsx)(Ce,{setSidebar:S,url:t,urlEmbed:n})})),"ruler"===k&&Object(y.jsx)(Pe,{setSidebar:S,title:"Pitch ruler",desc:"Click and drag to pan, use mousewheel to zoom.",children:Object(y.jsx)(Ot,{rulerState:h})})]}),L=Object(y.jsx)(yr,{tuneForm:i,parsedForm:a,selectedLine:l}),D=Object(y.jsx)(wr,{tuneForm:i}),H=i.render("url",(function(e){return Object(y.jsx)(zr,{href:e.useValue(),target:"_blank",children:"Edit on Xenpaper"})}));return i.branch("embed").useValue()?Object(y.jsx)(xr,{playPause:R,loop:P,code:L,openOnXenpaper:H,htmlTitle:D,codepaneContainerProps:C}):Object(y.jsx)(gr,{playPause:R,undoRedo:N,loop:P,code:L,htmlTitle:D,sidebarToggles:_,sidebar:A,codepaneContainerProps:C})}function gr(e){var t=e.playPause,n=e.undoRedo,r=e.loop,o=e.code,c=e.htmlTitle,i=e.sidebarToggles,a=e.sidebar,s=e.codepaneContainerProps;return Object(y.jsxs)(ke,{height:"100vh",flexDirection:"column",children:[Object(y.jsxs)(ke,{display:["block","flex"],flexGrow:"1",flexShrink:"1",minHeight:"0",position:"relative",children:[Object(y.jsxs)(kr,{display:["flex","none"],position:"fixed",top:0,width:"100%",children:[t,n,r]}),Object(y.jsxs)(kr,{display:["none","block"],mt:4,px:2,pt:"12px",children:[Object(y.jsx)(we,{mb:3,children:t}),n,r,Object(y.jsx)(Sr,{my:2}),i]}),Object(y.jsx)(we,Object(p.a)(Object(p.a)({flexGrow:"1",flexShrink:"1",pl:[0,3],overflow:"auto",mt:3,pt:["24px",3]},s),{},{children:o})),Object(y.jsx)(Sr,{display:["block","none"],mt:4}),Object(y.jsx)(we,{display:["flex","none"],children:i}),a]}),Object(y.jsx)(Te,{display:["none","none","block"]}),c]})}function xr(e){var t=e.playPause,n=e.loop,r=e.code,o=e.htmlTitle,c=e.openOnXenpaper,i=e.codepaneContainerProps;return Object(y.jsxs)(ke,{height:"100vh",flexDirection:"column",children:[Object(y.jsxs)(ke,{flexGrow:"1",flexShrink:"1",minHeight:"0",position:"relative",children:[Object(y.jsxs)(kr,{display:"flex",position:"fixed",top:0,width:"100%",children:[t,n,c]}),Object(y.jsx)(we,Object(p.a)(Object(p.a)({flexGrow:"1",flexShrink:"1",overflow:"auto",mt:3,pt:"24px"},i),{},{children:r}))]}),o]})}function yr(e){return e.tuneForm.render((function(t){var n=t.branch("embed").useValue(),r=e.parsedForm.useValue(),o=r.chars,c=r.error,i=Object(Xe.c)(t.branch("tune"),200),a=i.value.split(""),s=a.map((function(e,t){return null===o||void 0===o?void 0:o[t]})),l=a.some((function(e){return"\n"===e})),u=0,d=[],h=function(){d.push(Object(y.jsx)(Tr,{line:u++,selectedLine:e.selectedLine},"playstart".concat(u)))};l&&h(),s.forEach((function(e,t){var n=a[t];d.push(Object(y.jsx)(ge,{ch:n,charData:e,soundEngine:jr},t)),"\n"===n&&h()}));return Object(y.jsxs)(we,{onClick:function(e){return e.stopPropagation()},children:[Object(y.jsx)(de,Object(p.a)(Object(p.a)({},i),{},{charElements:d,freeze:n})),c&&Object(y.jsx)(we,{children:Object(y.jsxs)(me,{children:["Error: ",c]})})]})}))}function wr(e){return e.tuneForm.render("tune",(function(e){var t=e.useValue(),n=0===t.length?"Xenpaper":t.length>20?"Xenpaper: ".concat(t.slice(0,20),"..."):"Xenpaper: ".concat(t);return Object(y.jsxs)(br.a,{children:[Object(y.jsx)("title",{children:n}),Object(y.jsx)("meta",{property:"og:title",content:n})]})}))}var kr=Object(x.d)(we)(cr||(cr=Object(f.a)(["\n     background-color: ",";\n     z-index: 4;\n"])),(function(e){return e.theme.colors.background.normal})),Sr=Object(x.d)(we)(ir||(ir=Object(f.a)(["\n     border-top: 1px "," solid;\n"])),(function(e){return e.theme.colors.background.light})),Er=x.d.button(ar||(ar=Object(f.a)(["\n    border: none;\n    display: block;\n    padding: ",";\n    cursor: ",";\n    background-color: ",";\n    color: ",";\n    position: relative;\n    outline: none;\n    font-family: ",";\n    font-size: ",";\n    text-align: center;\n    width: auto;\n    text-transform: uppercase;\n    border-left: 3px solid transparent;\n    ","\n\n    ","\n\n    @media all and (min-width: ",") {\n        padding: .5rem;\n        font-size: ",";\n        width: 5rem;\n    }\n"])),(function(e){return e.multiline?".5rem":"1rem .5rem"}),(function(e){return e.disabled?"default":"pointer"}),(function(e){return e.active?e.theme.colors.text.placeholder:e.theme.colors.background.normal}),(function(e){return e.disabled?e.theme.colors.highlights.unknown:e.active?e.theme.colors.background.normal:e.theme.colors.highlights.comment}),(function(e){return e.theme.fonts.mono}),(function(e){return e.multiline?"0.8rem":"0.9rem"}),(function(e){return e.multiline&&"line-height: 1em;"}),(function(e){return e.active?"":"&:hover, &:focus, &:active {\n        background-color: ".concat(e.theme.colors.background.light,";\n    }")}),(function(e){return e.theme.widths.sm}),(function(e){return e.multiline?"0.9rem":"1.1rem"})),zr=x.d.a(sr||(sr=Object(f.a)(["\n    border: none;\n    height: 3rem;\n    line-height: 1rem;\n    display: block;\n    padding: ",";\n    cursor: pointer;\n    background-color: ",";\n    color: ",";\n    position: relative;\n    outline: none;\n    font-family: ",";\n    font-size: ",";\n    text-align: center;\n    width: auto;\n    text-transform: uppercase;\n    border-left: 3px solid transparent;\n    ","\n    text-decoration: none;\n\n    &:hover, &:focus, &:active {\n        background-color: ",";\n        text-decoration: none;\n    }\n\n    margin-left: auto;\n\n    @media all and (min-width: ",") {\n        font-size: ",";\n    }\n"])),(function(e){return e.multiline?".5rem":"1rem .5rem"}),(function(e){return e.theme.colors.background.normal}),(function(e){return e.theme.colors.highlights.comment}),(function(e){return e.theme.fonts.mono}),(function(e){return e.multiline?"0.8rem":"0.9rem"}),(function(e){return e.multiline&&"line-height: 1em;"}),(function(e){return e.theme.colors.background.light}),(function(e){return e.theme.widths.sm}),(function(e){return e.multiline?"0.9rem":"1.1rem"})),Tr=Object(x.d)((function(e){var t=e.line,n=e.selectedLine,r=Object(j.a)(e,["line","selectedLine"]);return Object(y.jsx)("span",Object(p.a)(Object(p.a)({},r),{},{onClick:function(){return n.set(t)},children:">"}))}))(lr||(lr=Object(f.a)(["\n    position: absolute;\n    left: .8rem;\n    border: none;\n    display: block;\n    cursor: pointer;\n    color: ",";\n    outline: none;\n    opacity: ",";\n    pointer-events: auto;\n\n    transition: opacity .2s ease-out;\n\n    &:hover, &:focus, &:active {\n        opacity: 1;\n    }\n"])),(function(e){return e.theme.colors.text.placeholder}),(function(e){return e.selectedLine.useValue()===e.line?"1":".2"})),Mr=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,74)).then((function(t){var n=t.getCLS,r=t.getFID,o=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),o(e),c(e),i(e)}))};b.a.render(Object(y.jsx)(d.a.StrictMode,{children:Object(y.jsx)(vr,{})}),document.getElementById("root")),Mr()}},[[73,1,2]]]);
//# sourceMappingURL=main.eb1a08ae.chunk.js.map